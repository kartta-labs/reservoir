{% extends "mainapp/layout.html" %}
{% block pagename %}Documentation{% endblock %}
{% block headadditions %}
<style>
	.response {
		padding-top: 10px;
	}
	.panel:target h3 {
		text-decoration: underline;
	}
</style>
{% endblock %}
{% block body %}
<div class="container">
	<div class="col-12">
	<h1>API Documentation</h1>
	</div>
	<div class="row">
		<div class="col-md-2">
			<h2>Model</h2>
			<ul>
				<li><a href="#info">Info Get</a></li>
				<li><a href="#model">Model Get</a></li>
				<li><a href="#filelist">File List</a></li>
				<li><a href="#file">File</a></li>
			</ul>
			<h2>Lookups</h2>
			<ul>
				<li><a href="#tag">Tag Lookup</a></li>
				<li><a href="#category">Category Lookup</a></li>
				<li><a href="#author">Author Lookup</a></li>
			</ul>
			<h2>Searches</h2>
			<ul>
				<li><a href="#title">Title Search</a></li>
				<li><a href="#latlon">Coordinate Search</a></li>
				<li><a href="#full">Full Search</a></li>
			</ul>
		</div>
		<div class="col-md-10">
			<h2>Model</h2>
			<div class="panel panel-primary" id="info">
				<div class="panel-heading">
					<h3 class="panel-title">Info Get</h3>
				</div>
				<div class="panel-body">
					<p>Returns the model information for the specified model id.</p>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/info/&lt;int:modelid&gt;</span>
					<br>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/info/&lt;int:modelid&gt;/&lt;int:revision&gt;</span>
					<p class="response">Sample (prettified) Response:</p>
<pre><code>{
	"id": 423,
	"title": "Eiffel Tower",
	"lat": 48.8583,
	"lon": 2.2945,
	"desc": "A model of the world famous Eiffel Tower",
	"tags": {
		"shape": "pyramidal",
		"building": "yes",
		"tourism": "attraction",
	}
	"author": "n42k",
	"date": "2017-03-28",
	"categories": ["monuments", "tall"],
	"comments": [
	{
		"author": "n42k",
		"body": "I've technically been here!"
	},
	{
		"author": "n42k",
		"body": "test comment"
	}
	]
}</code></pre>
				</div>
			</div>
			<div class="panel panel-primary" id="model">
				<div class="panel-heading">
					<h3 class="panel-title">Model Get</h3>
				</div>
				<div class="panel-body">
					<p>Returns a zip with the model of the specified model id.</p>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/model/&lt;int:modelid&gt;</span>
					<br>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/model/&lt;int:modelid&gt;/&lt;int:revision&gt;</span>
					<p class="response">Sample Response: a zip file.</p>
				</div>
			</div>
			<div class="panel panel-primary" id="filelist">
				<div class="panel-heading">
					<h3 class="panel-title">File List</h3>
				</div>
				<div class="panel-body">
					<p>Returns a listing of all the files present in the model zip.</p>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/filelist/&lt;int:modelid&gt;</span>
					<br>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/filelist/&lt;int:modelid&gt;/&lt;int:revision&gt;</span>
					<p class="response">Sample Response:</p>
<pre><code>EiffelTowerLarge_copy.png
EiffelTowerLarge_copy_0.png
eiffel.mtl
eiffel.obj
et.jpg</code></pre>
				</div>
			</div>
			<div class="panel panel-primary" id="file">
				<div class="panel-heading">
					<h3 class="panel-title">File</h3>
				</div>
				<div class="panel-body">
					<p>Returns a file from the model zip.</p>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/filelatest/&lt;int:modelid&gt;/&lt;string:filename&gt;</span>
					<br>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/file/&lt;int:modelid&gt;/&lt;int:revision&gt;/&lt;string:filename&gt;</span>
					<p class="response">Sample Response: a file.</p>
				</div>
			</div>
			<h2>Lookups</h2>
			<div class="panel panel-primary" id="tag">
				<div class="panel-heading">
					<h3 class="panel-title">Tag Lookup</h3>
				</div>
				<div class="panel-body">
					<p>Returns model ids that have the specified tag as one of their tags.</p>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/tag/&lt;string:tag&gt;</span>
					<br>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/tag/&lt;string:tag&gt;/&lt;int:pageid&gt;</span>
					<p class="response">Sample Response:</p>
					<pre><code>[3, 5]</code></pre>
				</div>
			</div>
			<div class="panel panel-primary" id="category">
				<div class="panel-heading">
					<h3 class="panel-title">Category Lookup</h3>
				</div>
				<div class="panel-body">
					<p>Returns model ids that have the specified category as one of their categories.</p>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/category/&lt;string:tag&gt;</span>
					<br>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/category/&lt;string:tag&gt;/&lt;int:pageid&gt;</span>
					<p class="response">Sample Response:</p>
					<pre><code>[6, 8]</code></pre>
				</div>
			</div>
			<div class="panel panel-primary" id="author">
				<div class="panel-heading">
					<h3 class="panel-title">Author Lookup</h3>
				</div>
				<div class="panel-body">
					<p>Returns model ids that have the specified author as one of their categories.</p>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/author/&lt;string:username&gt;</span>
					<br>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/author/&lt;string:username&gt;/&lt;int:pageid&gt;</span>
					<p class="response">Sample Response:</p>
					<pre><code>[6, 8]</code></pre>
				</div>
			</div>
			<h2>Searches</h2>
			<div class="panel panel-primary" id="title">
				<div class="panel-heading">
					<h3 class="panel-title">Title Search</h3>
				</div>
				<div class="panel-body">
					<p>Returns model ids that contain the specified string in their title.</p>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/search/title/&lt;string:title&gt;</span>
					<br>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/search/title/&lt;string:title&gt;/&lt;int:pageid&gt;</span>
					<p class="response">Sample Response:</p>
					<pre><code>[2, 10, 17]</code></pre>
				</div>
			</div>
			<div class="panel panel-primary" id="latlon">
				<div class="panel-heading">
					<h3 class="panel-title">Latitude and Longitude Search</h3>
				</div>
				<div class="panel-body">
					<p>Returns model ids that have the specified category as one of their categories.</p>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/search/&lt;float:lat&gt;/&lt;float:lon&gt;/&lt;float:range&gt;</span>
					<br>
					<span class="label label-success">GET</span>
					<span class="label label-default">/api/search/&lt;float:lat&gt;/&lt;float:lon&gt;/&lt;float:range&gt;/&lt;int:pageid&gt;</span>
					<p class="response">Sample Response:</p>
					<pre><code>[2, 10, 17]</code></pre>
				</div>
			</div>
			<div class="panel panel-primary" id="full">
				<div class="panel-heading">
					<h3 class="panel-title">Full Search</h3>
				</div>
				<div class="panel-body">
					<p>Permits combining various criteria to find the exact kinds of models we need. Search query is sent in the request body. If any parameter is not specified, it's ignored and won't be filtered from the results.</p>
					<p>Notes:</p>
					<ul>
						<li>The "lat", "lon" and "range" attributes do what is described in the <a href="#latlon">Latitude and Longitude Search</a> endpoint.</li>
						<li>The "title" attribute does what is described in the <a href="#title">Title Search</a> endpoint.</li>
						<li>The "tags" attribute finds models that match all tags.</li>
						<li>The "categories" attribute finds models that match all categories.</li>
						<li>The "author" attribute does what is described in the <a href="#author">Author Lookup</a> endpoint.</li>
						<li>Only models that match all attributes are returned</li>
						<li>The "format" attribute allows you to retrieve more than the model id, allowing quick access to the location and title of many models around a point, for example.</li>
					</ul>
					<span class="label label-danger">POST</span>
					<span class="label label-default">/api/search/full</span>
					<p class="response">Live request body (try pressing Submit!):</p>
					<script>
						function send() {
							var query = document.getElementById("json").value;
							var responseElement = document.getElementById("response");

							var xhr = new XMLHttpRequest();
							xhr.open('POST', '/api/search/full', true);

							xhr.onreadystatechange = function() {
								if(xhr.status == 200) {
									responseElement.innerHTML = xhr.responseText;
								} else {
									responseElement.innerHTML = 'error';
								}
							}

							xhr.send(query);

							return false;
						}
					</script>
					<form>
						<textarea id="json" rows="20" cols="80">{
	"lat": 48.8583,
	"lon": 2.2945,
	"range": 1000,
	"title": "Eiffel",
	"tags": {
		"shape": "pyramidal",
		"building": "yes"
	},
	"categories": [
		"monuments",
		"tall"
	],
	"page": 1,
	"author": "n42k"
}</textarea><br>
						<input type="submit" onclick="return send()">
					</form>
					<p class="response">Response:</p>
					<pre><code id="response">(None yet)</code></pre>
					<p class="response">Sample request body:</p>
<pre><code>{
"lat": 48.8583,
"lon": 2.2945,
"range": 1000,
"title": "Eiffel",
"tags": {
"shape": "pyramidal",
"building": "yes"
},
"categories": [
"monuments",
"tall"
],
"page": 1,
"author": "n42k"
}</code></pre>
					<p class="response">Sample Response:</p>
					<pre><code>[6, 8]</code></pre>
					<p class="response">Sample request body with format attribute:</p>
<pre><code>{
"lat": 48.8583,
"lon": 2.2945,
"range": 1000,
"format": ["id", "latitude", "longitude", "title"]
}</code></pre>
					<p class="response">Sample Response:</p>
					<pre><code>[[1, 48.8583, 2.2945, "Eiffel Tower"], [64, 48.85831, 2.2945, "Near Eiffel Tower"]]</code></pre>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
